name: build and deploy
on:
  push:
    branches:
      - main # main 分支有 push 行为时就触发这个 action
jobs:
  build-deploy:
    runs-on: ubuntu-latest
    steps:
      # # 下载仓库代码
      # - uses: actions/checkout@v2
      # # 缓存依赖
      # - name: Get yarn cache
      #   id: yarn-cache
      #   run: echo "::set-output name=dir::$(yarn cache dir)"
      # - uses: actions/cache@v1
      #   with:
      #     path: ${{ steps.yarn-cache.outputs.dir }}
      #     key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
      #     restore-keys: |
      #       ${{ runner.os }}-yarn-
      # # 安装依赖
      # - run: npm ci
      # # 打包构建
      # - run: npm run docs:build
      #   env:
      #     CI: false
      - name: Checkout
        uses: actions/checkout@v3

      - name: Use Node.js 18
        uses: actions/setup-node@v3
        with:
          node-version: "18.x"

      - name: Build Project
        run: |
          npm ci
          npm run docs:build
      # 发布到 GitHub Pages
      # - name: Deploy
      #   uses: peaceiris/actions-gh-pages@v2
      #   env:
      #     PERSONAL_TOKEN: ${{ secrets.ACCESS_TOKEN }} # 访问秘钥
      #     PUBLISH_BRANCH: gh-pages # 推送分支
      #     PUBLISH_DIR: .vitepress/dist # 部署目录
      - name: Deploy GitHub Pages
          uses: peaceiris/actions-gh-pages@v3
          with:
            github_token: ${{ secrets.ACCESS_TOKEN }}
            publish_dir: .vitepress/dist
